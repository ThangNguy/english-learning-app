<div class="progress-container">
  <div class="header">
    <button mat-icon-button color="primary" class="back-button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="page-title">Progress Report</h1>
  </div>
  
  <!-- Card thông tin thành viên -->
  <mat-card class="member-card" *ngIf="member()">
    <div class="member-info">
      <div class="avatar-container">
        <img [src]="member().avatar" [alt]="member().name" class="member-avatar">
        <div class="streak-badge" *ngIf="member().streak">
          <mat-icon>local_fire_department</mat-icon>
          <span>{{ member().streak }}</span>
        </div>
      </div>
      <div class="member-details">
        <h2 class="member-name">{{ member().name }}</h2>
        <div class="member-meta">
          <span class="age">{{ member().age }} years old</span>
          <span class="role">{{ member().role }}</span>
        </div>
        <div class="points-container">
          <mat-icon class="points-icon">emoji_events</mat-icon>
          <span class="points-value">{{ member().totalPoints }} points</span>
        </div>
      </div>
      <div class="last-active">
        <span class="last-active-label">Last active</span>
        <span class="last-active-time">{{ formatDate(member().lastActive) }} at {{ formatTime(member().lastActive) }}</span>
      </div>
    </div>
  </mat-card>
  
  <!-- Tabs cho các loại báo cáo -->
  <mat-tab-group animationDuration="300ms" class="progress-tabs">
    <!-- Tab Tổng quan -->
    <mat-tab label="Overview">
      <div class="tab-content">
        <!-- Thống kê chính -->
        <div class="statistics-container">
          <div class="statistics-card" *ngFor="let stat of statistics()">
            <div class="stat-icon">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-data">
              <div class="stat-value">{{ stat.value }} <span class="stat-unit">{{ stat.unit }}</span></div>
              <div class="stat-name">{{ stat.name }}</div>
              <div class="stat-trend" *ngIf="stat.trend">
                <mat-icon class="trend-icon" 
                         [ngClass]="{'trend-up': stat.trend === 'up', 'trend-down': stat.trend === 'down', 'trend-stable': stat.trend === 'stable'}">
                  {{ stat.trend === 'up' ? 'trending_up' : stat.trend === 'down' ? 'trending_down' : 'trending_flat' }}
                </mat-icon>
                <span class="trend-value" [ngClass]="{'trend-up': stat.trend === 'up', 'trend-down': stat.trend === 'down'}">
                  {{ stat.trend === 'up' ? '+' : stat.trend === 'down' ? '-' : '' }}{{ stat.trendValue }}%
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Biểu đồ tiến trình theo thời gian -->
        <div class="chart-container">
          <div class="chart-header">
            <h2 class="chart-title">Progress Over Time</h2>
            <div class="period-selector">
              <button mat-button 
                     [ngClass]="{'active-period': selectedPeriod() === 'week'}" 
                     (click)="changePeriod('week')">Week</button>
              <button mat-button 
                     [ngClass]="{'active-period': selectedPeriod() === 'month'}" 
                     (click)="changePeriod('month')">Month</button>
              <button mat-button 
                     [ngClass]="{'active-period': selectedPeriod() === 'year'}" 
                     (click)="changePeriod('year')">Year</button>
            </div>
          </div>
          <div class="chart-content">
            <!-- Hiển thị biểu đồ ở đây - bạn cần thêm thư viện biểu đồ như Chart.js -->
            <div class="chart-placeholder">
              <div class="chart-info">
                <p class="chart-labels">Labels: {{ weeklyProgressChart()?.labels.join(', ') }}</p>
                <div *ngFor="let dataset of weeklyProgressChart()?.datasets">
                  <p class="chart-dataset">{{ dataset.label }}: {{ dataset.data.join(', ') }}</p>
                </div>
              </div>
              <div class="chart-image">
                <img src="assets/images/progress-chart-placeholder.png" alt="Progress Chart">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Hoạt động gần đây -->
        <div class="recent-activities">
          <h2 class="section-title">Recent Activities</h2>
          <div class="activities-list">
            <div class="activity-item" *ngFor="let activity of recentActivities()">
              <div class="activity-date">
                <div class="date">{{ formatDate(activity.date) }}</div>
                <div class="time">{{ formatTime(activity.date) }}</div>
              </div>
              <div class="activity-icon" [ngClass]="getActivityClass(activity.type)">
                <mat-icon>{{ getActivityIcon(activity.type) }}</mat-icon>
              </div>
              <div class="activity-details">
                <div class="activity-name">{{ activity.name }}</div>
                <div class="activity-meta">
                  <span class="activity-topic" *ngIf="activity.topic">
                    <mat-icon class="meta-icon">category</mat-icon>
                    {{ activity.topic }}
                  </span>
                  <span class="activity-duration">
                    <mat-icon class="meta-icon">timer</mat-icon>
                    {{ activity.duration }} min
                  </span>
                  <span class="activity-score" *ngIf="activity.score !== undefined">
                    <mat-icon class="meta-icon">grade</mat-icon>
                    {{ activity.score }}%
                  </span>
                </div>
              </div>
              <div class="activity-status">
                <mat-icon *ngIf="activity.completed" class="completed-icon">check_circle</mat-icon>
                <mat-icon *ngIf="!activity.completed" class="incomplete-icon">pending</mat-icon>
              </div>
            </div>
          </div>
          <button mat-button color="primary" class="view-all-button">
            View All Activities
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>
    </mat-tab>
    
    <!-- Tab Thành tích -->
    <mat-tab label="Achievements">
      <div class="tab-content">
        <div class="achievements-container">
          <div class="achievement-item" *ngFor="let achievement of achievements()">
            <div class="achievement-card" [ngClass]="{'unlocked': achievement.unlocked, 'locked': !achievement.unlocked}">
              <div class="achievement-icon">
                <mat-icon class="achievement-icon-inner">{{ achievement.iconName }}</mat-icon>
              </div>
              <div class="achievement-details">
                <h3 class="achievement-name">{{ achievement.name }}</h3>
                <p class="achievement-description">{{ achievement.description }}</p>
                
                <div class="achievement-date" *ngIf="achievement.unlocked && achievement.date">
                  Earned on {{ formatDate(achievement.date) }}
                </div>
                
                <div class="achievement-progress" *ngIf="!achievement.unlocked && achievement.progress !== undefined">
                  <mat-progress-bar 
                    [value]="(achievement.progress / (achievement.totalRequired || 1)) * 100" 
                    color="accent">
                  </mat-progress-bar>
                  <span class="progress-text">{{ achievement.progress }}/{{ achievement.totalRequired }}</span>
                </div>
              </div>
              
              <div class="achievement-status">
                <mat-icon *ngIf="achievement.unlocked" class="status-icon unlocked">stars</mat-icon>
                <mat-icon *ngIf="!achievement.unlocked" class="status-icon locked">lock</mat-icon>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    
    <!-- Tab Tiến độ chủ đề -->
    <mat-tab label="Topics">
      <div class="tab-content">
        <!-- Biểu đồ phân bố từ vựng theo chủ đề -->
        <div class="chart-container topic-chart">
          <h2 class="chart-title">Topic Distribution</h2>
          <div class="chart-content">
            <!-- Hiển thị biểu đồ ở đây - bạn cần thêm thư viện biểu đồ như Chart.js -->
            <div class="chart-placeholder">
              <div class="chart-info">
                <p class="chart-labels">Topics: {{ topicDistributionChart()?.labels.join(', ') }}</p>
                <div *ngFor="let dataset of topicDistributionChart()?.datasets">
                  <p class="chart-dataset">{{ dataset.label }}: {{ dataset.data.join(', ') }}</p>
                </div>
              </div>
              <div class="chart-image">
                <img src="assets/images/pie-chart-placeholder.png" alt="Topics Distribution">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Danh sách tiến độ chủ đề -->
        <div class="topics-container">
          <h2 class="section-title">Topics Progress</h2>
          <div class="topics-list">
            <div class="topic-item" *ngFor="let topic of topicProgress()">
              <div class="topic-header">
                <h3 class="topic-name">{{ topic.name }}</h3>
                <div class="topic-meta">
                  <span class="words-count">{{ topic.learnedWords }}/{{ topic.totalWords }} words</span>
                  <span class="last-studied">Last studied: {{ formatDate(topic.lastStudied) }}</span>
                </div>
              </div>
              <div class="topic-progress">
                <mat-progress-bar [value]="topic.progress" [color]="getProgressColor(topic.progress)"></mat-progress-bar>
                <span class="progress-value">{{ topic.progress }}%</span>
              </div>
              <button mat-button color="primary" class="continue-button">Continue Learning</button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>